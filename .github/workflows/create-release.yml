name: actions/create-release
on: [push]
jobs:
  retrieve-changes:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get Last Release Time
      id: last-release-time
      run: |
        last_release_time=$(gh release list --limit=1 --format="%(taggable_time)" | awk -F "[-T:]" '{print $1"-"$2"-"$3"T"$4":"$5":"$6"Z"}')
        echo "::set-output name=last_release_time::$last_release_time"

    - name: List Closed PRs Since Last Release
      id: closed-prs
      run: |
        closed_prs=$(gh pr list --state closed --base main --grep "" --json "base.ref=='main'&&updated_at>='${{ steps.last-release-time.outputs.last_release_time }}'&&base.sha!=$(git rev-parse $(gh release list --limit=1 --format='%(target_commitish)'))")
        echo "::set-output name=closed_prs::$closed_prs"

    - name: Print Closed PRs
      run: |
        echo "Closed PRs Since Last Release:"
        echo "${{ steps.closed-prs.outputs.closed_prs }}"
